package com.revature.servlets;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.revature.models.Employee;
import com.revature.services.EmployeeServices;
import com.revature.services.ReimbursementService;

@WebServlet("/updateReimbursement")
public class UpdateReimbursementServlet extends HttpServlet {

	private static final long serialVersionUID = 1L;

	//updating of reimbursement records(manager exclusive)
	protected void doPut(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException{
		
		System.out.println("CHeck");
		// create appropriate service objects
		ReimbursementService reimburseService = new ReimbursementService();
		EmployeeServices employeeService = new EmployeeServices();

		// map incoming JSON information to an array
		ObjectMapper mapper = new ObjectMapper();
		String[] userFields = mapper.readValue(request.getInputStream(), String[].class);
		int userID = Integer.parseInt(userFields[0]);
		int reimbID = Integer.parseInt(userFields[1]);
		int status = Integer.parseInt(userFields[2]);
		Employee manager = Employee.duplicate(employeeService.getEmployee(userID));
		
		reimburseService.updateReimbursement(manager, reimbID, status);
	}
}
